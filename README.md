# [CV-11] Toonslator | ìƒë™ê°ìˆëŠ” ì›¹íˆ° ìë™ ë²ˆì—­ ì„œë¹„ìŠ¤

# **ğŸ’**Â íŒ€ ì†Œê°œ
## CV 11ì¡° ğŸ¦Šêµ¬ë¯¸í˜¸ğŸ¦Š
| [ë¥˜ê±´](https://github.com/jerry-ryu) | [ì‹¬ê±´í¬](https://github.com/jane79) | [ìœ¤íƒœì¤€](https://github.com/ta1231) | [ì´ê°•í¬](https://github.com/ganghe74) | [ì´ì˜ˆë¼](https://github.com/Yera10) |
| :-: | :-: | :-: | :-: | :-: |
| <img src="https://avatars.githubusercontent.com/u/62556539?v=4" width="200"> | <img src="https://avatars.githubusercontent.com/u/48004826?v=4" width="200"> | <img src="https://avatars.githubusercontent.com/u/54363784?v=4"  width="200"> | <img src="https://avatars.githubusercontent.com/u/30896956?v=4" width="200"> | <img src="https://avatars.githubusercontent.com/u/57178359?v=4" width="200"> |
|[Blog](https://kkwong-guin.tistory.com/)  |[Blog](https://velog.io/@goodheart50)|[Blog](https://velog.io/@ta1231)| [Blog](https://dddd.ac/blog) | [Blog](https://yedoong.tistory.com/) |
| <code>ëª¨ë¸ë§</code><br><code>íŒŒì´í”„ë¼ì¸</code><br><code>ë°ì´í„° ìˆ˜ì§‘</code> | <code>ëª¨ë¸ë§</code><br><code>ì—°êµ¬</code><br><code>ë°ì´í„° ìˆ˜ì§‘</code>  |  <code>ë°±ì—”ë“œ</code><br><code>ë°œí‘œìë£Œ</code><br><code>í˜‘ì—… ê´€ë¦¬</code>  | <code>í”„ë¡ íŠ¸ì—”ë“œ</code><br><code>ì„œë¹„ìŠ¤ ë°°í¬</code><br><code>íŒŒì´í”„ë¼ì¸</code> | <code>ë°±ì—”ë“œ</code><br><code>ì„œë¹„ìŠ¤ ë°°í¬</code><br><code>íŒŒì´í”„ë¼ì¸</code> |

<div align="center">

![python](http://img.shields.io/badge/Python-000000?style=flat-square&logo=Python)
![pytorch](http://img.shields.io/badge/PyTorch-000000?style=flat-square&logo=PyTorch)
![ubuntu](http://img.shields.io/badge/Ubuntu-000000?style=flat-square&logo=Ubuntu)
![git](http://img.shields.io/badge/Git-000000?style=flat-square&logo=Git)
![github](http://img.shields.io/badge/Github-000000?style=flat-square&logo=Github)
![React](https://img.shields.io/badge/React-000000?style=flat-square&logo=react)
![FastAPI](https://img.shields.io/badge/FastAPI-000000?style=flat-square&logo=fastapi)

</div align="center">

## ëª©ì°¨

- [í”„ë¡œì íŠ¸ ì†Œê°œ](#í”„ë¡œì íŠ¸-ì†Œê°œ)
  * [Toonslator](#toonslator)
  * [Environments](#environments)
  * [Repository Tree](#repository-êµ¬ì¡°)
  * [í”„ë¡œì íŠ¸ ë°°ê²½](#í”„ë¡œì íŠ¸-ë°°ê²½)
  * [ë¬¸ì œì •ì˜ ë° í”„ë¡œì íŠ¸ ëª©í‘œ](#ë¬¸ì œì •ì˜-ë°-í”„ë¡œì íŠ¸-ëª©í‘œ)
  * [ì„œë¹„ìŠ¤ ì•„í‚¤í…ì²˜](#ì„œë¹„ìŠ¤-ì•„í‚¤í…ì²˜)
  * [ì„œë¹„ìŠ¤ íŒŒì´í”„ë¼ì¸](#ì„œë¹„ìŠ¤-íŒŒì´í”„ë¼ì¸)

- [Demo](#demo)

- [ì‹¤í–‰ë°©ë²•](#ì‹¤í–‰ë°©ë²•)
  * [Frontend](#frontend)
  * [Backend](#backend)

- [Reference](#reference)


# **ğŸ“ƒ**Â í”„ë¡œì íŠ¸ ì†Œê°œ

## ğŸ§‘â€ğŸ¨ToonslatorğŸ¨

ì €í¬ì˜ ì„œë¹„ìŠ¤ëŠ” ì‘í’ˆì„ í•´ì™¸ë¡œ ì§„ì¶œí•˜ê³  ì‹¶ì€ ì›¹íˆ° ì‘ê°€ë‚˜ ë²ˆì—­ ë° í¸ì§‘ì— ì–´ë ¤ì›€ì„ ê²ªëŠ” ë²ˆì—­-í¸ì§‘ìë¥¼ ìœ„í•œ ì„œë¹„ìŠ¤ë¥¼ ì œê³µí•©ë‹ˆë‹¤.

(Web**toon**)+(Translation)ì„ í•©ì³ Toonslatorë¼ëŠ” ì„œë¹„ìŠ¤ë¥¼ ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤.

## Environments
> - Ubuntu 18.04.5 LTS
> - Intel(R) Xeon(R) Gold 5120 CPU @ 2.20GHz
> - NVIDIA Tesla V100-PCIE-32GB
> - React
> - pytorch
> - FastAPI
> - Nginx
> - OpenCV

## **Repository êµ¬ì¡°**

```
<final-project-level2-cv-11>
|
ğŸ“œ-- README.md
ğŸ“‚-- notebooks
|   ğŸ“œ-- font_ex.ipynb
|   ğŸ“„-- imagemaker.py
|   ğŸ“„-- tesseract_boxes.py
|   ğŸ“œ-- txt2json.ipynb
âš™ï¸-- poetry.lock
âš™ï¸-- pyproject.toml
ğŸ“‚-- src
    ğŸ“„-- __init__.py
    ğŸ“‚-- backend
    |   ğŸ“„-- __main__.py
    |   ğŸ“„-- main.py
    |   ğŸ“‚-- pipeline
    |   |   ğŸ“„-- __init_.py
    |   |   ğŸ“„-- typical_pipeline.py
    |   |   ğŸ“„-- untypical_pipeline.py
    |   ğŸ“‚-- routers
    |       ğŸ“„-- machine_translation.py
    |       ğŸ“„-- test.py
    |       ğŸ“„-- txt_extraction.py
    |       ğŸ“„-- untypical_generation.py
    |       ğŸ“„-- untypical_machine_translation.py
    |       ğŸ“„-- untypical_txt_extraction.py
    ğŸ“‚-- frontend
    |   ğŸ“œ-- README.md
    |   ğŸ“œ-- package-lock.json
    |   ğŸ“œ-- package.json
    |   ğŸ“‚-- public
    |   ğŸ“‚-- src
    ğŸ“‚-- model
        ğŸ“‚-- MachineTranslate
        |   ğŸ“„-- papago_MT.py
        ğŸ“‚-- OCR
        |   ğŸ“„-- clova_OCR.py
        |   ğŸ“„-- tesseract_OCR.py
        ğŸ“„-- __init__.py
        ğŸ“‚-- font_classifier
        |   ğŸ“„-- FC.py
        |   ğŸ“„-- dataset_font.py
        |   ğŸ“„-- inference_font.py
        |   ğŸ“„-- loss.py
        |   ğŸ“„-- model_font.py
        |   ğŸ“œ-- requirements.txt
        |   ğŸ“„-- scheduler.py
        |   ğŸ“„-- train_font.py
        |   ğŸ“‚-- weights
        ğŸ“‚-- font_color
        |   ğŸ“„-- font_color.py
        ğŸ“‚-- font_generator
        |   ğŸ“‚-- gasnext
        |   ğŸ“‚-- mxfont
        ğŸ“‚-- svg2ttf
            ğŸ“œ-- example.json
            ğŸ“„-- svgs2ttf.py
```

## **í”„ë¡œì íŠ¸ ë°°ê²½**

ë””ì§€í„¸ ë§Œí™”ì‹œì¥ì˜ ì ìœ ìœ¨ì´ ì ì°¨ ë†’ì•„ì ¸ ê²°êµ­ 2019ë…„ì—ëŠ” ì¸ì‡„ ë§Œí™” ì‹œì¥ì„ ë›°ì–´ ë„˜ì—ˆìŠµë‹ˆë‹¤.

ì†Œë¹„ìë“¤ì˜ ì„±ê³µì  ë°˜ì‘ìœ¼ë¡œ ì„¸ê³„ì ìœ¼ë¡œ ìˆ˜ì¶œ ì‹œì¥ì´ ì»¤ì§€ëŠ” ì¤‘ì…ë‹ˆë‹¤.

**í•˜ì§€ë§Œ  ë²ˆì—­ ë° í˜„ì§€í™” ê³¼ì •ì€ ì›¹íˆ° ìˆ˜ì¶œ ê³¼ì •ì—ì„œ ê±¸ë¦¼ëŒì…ë‹ˆë‹¤.**

![image](https://user-images.githubusercontent.com/54363784/217152294-bb9cd0b3-d447-4fda-824e-2a32f5f75151.png)

## **ë¬¸ì œì •ì˜ ë° í”„ë¡œì íŠ¸ ëª©í‘œ**

- ë¬¸ì œì •ì˜
    - ì ì ˆí•œ í¸ì§‘ ë„êµ¬ ì—†ì´ ë²ˆì—­ì„ í•  ê²½ìš° ë¹„ìš©ì´ ì¦ê°€
    - í˜„ì§€í™”ê°€ ì˜ ë˜ì§€ ì•ŠëŠ” ê²½ìš° ìˆ˜ìš” ê°ì†Œë¡œ ì¸í•œ ìˆ˜ìµ í•˜ë½
- í”„ë¡œì íŠ¸ ëª©í‘œ
    - **í¸ì§‘ ìë™í™”**ë¥¼ í†µí•´ ë²ˆì—­ê³¼ì •ì˜ **ë¹„ìš©ì„ ìµœì†Œí™”**í•˜ê³  ì†Œë¹„ì ì¦ê°€ë¥¼ í†µí•œ **ìˆ˜ìµ ê·¹ëŒ€í™”**ë¥¼ ëª©í‘œë¡œ í•©ë‹ˆë‹¤.
- ì„œë¹„ìŠ¤ íƒ€ê²Ÿ
    - ê¸€ë¡œë²Œí™”ë¥¼ ì›í•˜ëŠ” ì›¹íˆ° ì‘ê°€
    - ë²ˆì—­ ë° í¸ì§‘ì— ì–´ë ¤ì›€ì„ ê²ªëŠ” ì›¹íˆ° ë²ˆì—­-í¸ì§‘ì

![image](https://user-images.githubusercontent.com/54363784/217152371-42b6de05-53ce-4667-8258-3138f4f53860.png)

## ì„œë¹„ìŠ¤ ì•„í‚¤í…ì²˜

- **Frontend**
    - HTML
    - CSS
    - React
- **Backend**
    - FastAPI
- **API**
    - Clova OCR
    - Papago ê¸°ê³„ë²ˆì—­

![image](https://user-images.githubusercontent.com/54363784/217152401-3e46c546-d8cd-4f8b-8cde-781f0e58daca.png)

## ì„œë¹„ìŠ¤ íŒŒì´í”„ë¼ì¸

1. ì‚¬ìš©ìë¡œë¶€í„° ë°°ê²½, ëŒ€ì‚¬ íš¨ê³¼ìŒ ì´ë¯¸ì§€ë¥¼ ë°›ìŠµë‹ˆë‹¤.
2. ëŒ€ì‚¬ ì´ë¯¸ì§€ëŠ” ëŒ€ì‚¬ íŒŒì´í”„ë¼ì¸ì„ í†µí•´ ëŒ€ì‚¬ì˜ ìœ„ì¹˜ë¥¼ ì°¾ê³ , ë²ˆì—­ ë° í°íŠ¸ë¥¼ ë¶„ë¥˜ê³¼ì •ì„ ê±°ì¹©ë‹ˆë‹¤.
3. íš¨ê³¼ìŒ íŒŒì´í”„ë¼ì¸ì€ ëŒ€ì‚¬ íŒŒì´í”„ë¼ì¸ì„ í†µí•œ outputì„ ì‚¬ìš©í•˜ì—¬ í°íŠ¸ ìƒì„±í•˜ëŠ” ê³¼ì •ì„ ê±°ì¹©ë‹ˆë‹¤.
4. ë²ˆì—­ëœ ê²°ê³¼ë¬¼ì„ ì´ìš©í•˜ì—¬ í°íŠ¸ë¥¼ ìˆ˜ì •, ìœ„ì¹˜ ë³€ê²½, ìƒ‰ ë³€ê²½ ë“±ì˜ í¸ì§‘ì„ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
5. í¸ì§‘ì´ ì™„ë£Œë˜ë©´ ìµœì¢… ê²°ê³¼ë¬¼ì„ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

![image](https://user-images.githubusercontent.com/54363784/217152527-0a5e631a-94c9-43de-9234-8cbacd1bbe66.png)

## ê²°ê³¼ë¬¼
![image](https://user-images.githubusercontent.com/54363784/217299454-60cd10a4-f10f-4f5f-84b9-c408695230d4.png)

# ğŸ“¹Demo

### í”„ë¡œì íŠ¸ ì˜ìƒ

https://www.youtube.com/watch?v=ILJyhd24qd4
![ggg](https://user-images.githubusercontent.com/62556539/217452558-466a97d4-3e85-441f-be8d-6f6d207a0775.gif)


# ğŸš€ì‹¤í–‰ë°©ë²•


## Frontend

1. ê²½ë¡œ ì´ë™

```bash
cd src
cd frontend
```

2. Nodejs ì„¤ì¹˜ (ìš°ë¶„íˆ¬)

```bash
curl -fsSL https://deb.nodesource.com/setup_16.x | sudo -E bash - &&\
sudo apt-get install -y nodejs
```

3. íŒ¨í‚¤ì§€ ì„¤ì¹˜

```bash
npm install
```

4. ì„œë²„ ì‹œì‘

```bash
npm start
```

## Backend

1. íŒ¨í‚¤ì§€ í™˜ê²½ ì„¤ì •

```bash
pip install --user poetry
# (sudo) vi ~/.bashrc ì…ë ¥ í›„, ë§¨ ì•„ë˜ì— PATH="$HOME/.local/bin:$PATH" ì¶”ê°€ (í•œ ë²ˆë§Œ í•˜ë©´ ë¨)
# í”„ë¡œì íŠ¸ í´ë” ë‚´ì— ê°€ìƒí™˜ê²½ì„ ì €ì¥
poetry config virtualenvs.in-project true
# poetry ê°€ìƒí™˜ê²½ ë‚´ì—ì„œ ì‹¤í–‰
poetry shell
```

2. ê°€ì¤‘ì¹˜, font ë‹¤ìš´ë¡œë“œ ë° í™˜ê²½ë³€ìˆ˜ ì„¤ì •
- Font Classifier ê°€ì¤‘ì¹˜

```bash
# ë§í¬1 : https://drive.google.com/file/d/1a28eDYyOUrJEhvLHsfI1iFBHhA7LlWl7/view?usp=sharing
# -O ì˜µì…˜ì— ë‹¤ìš´ë°›ì„ ê²½ë¡œ ì§€ì •
wget --load-cookies ~/cookies.txt "https://docs.google.com/uc?export=download&confirm=$(wget --quiet --save-cookies ~/cookies.txt --keep-session-cookies --no-check-certificate 'https://docs.google.com/uc?export=download&id=1a28eDYyOUrJEhvLHsfI1iFBHhA7LlWl7' -O- | sed -rn 's/.*confirm=([0-9A-Za-z_]+).*/\1\n/p')&id=1a28eDYyOUrJEhvLHsfI1iFBHhA7LlWl7" -O /opt/ml/final-project-level2-cv-11/src/model/font_classifier/weights/typical/weight.pth && rm -rf ~/cookies.txt
```
```bash
# ë§í¬2 : https://drive.google.com/file/d/107iA6ir5Fbii-5JimkGaL-HBomTDeKR1/view?usp=sharing
wget --load-cookies ~/cookies.txt "https://docs.google.com/uc?export=download&confirm=$(wget --quiet --save-cookies ~/cookies.txt --keep-session-cookies --no-check-certificate 'https://docs.google.com/uc?export=download&id=107iA6ir5Fbii-5JimkGaL-HBomTDeKR1' -O- | sed -rn 's/.*confirm=([0-9A-Za-z_]+).*/\1\n/p')&id=107iA6ir5Fbii-5JimkGaL-HBomTDeKR1" -O /opt/ml/final-project-level2-cv-11/src/model/font_classifier/weights/untypical/weight.pth && rm -rf ~/cookies.txt
```

- Font Generator ê°€ì¤‘ì¹˜

```bash
# mxfontë§í¬: https://drive.google.com/file/d/1URxBMtHx1SXAAJ4b4A2jbmD44S1Ns1Jp/view?usp=sharing
wget --load-cookies ~/cookies.txt "https://docs.google.com/uc?export=download&confirm=$(wget --quiet --save-cookies ~/cookies.txt --keep-session-cookies --no-check-certificate 'https://docs.google.com/uc?export=download&id=1URxBMtHx1SXAAJ4b4A2jbmD44S1Ns1Jp' -O- | sed -rn 's/.*confirm=([0-9A-Za-z_]+).*/\1\n/p')&id=1URxBMtHx1SXAAJ4b4A2jbmD44S1Ns1Jp" -O /opt/ml/final-project-level2-cv-11/src/model/font_generator/mxfont/mxfont_weight.pth && rm -rf ~/cookies.txt
```
```bash
# gasnextë§í¬: https://drive.google.com/file/d/173SEHgYuSoJ6eze-BaofzJutjd6bAIGo/view?usp=sharing
wget --load-cookies ~/cookies.txt "https://docs.google.com/uc?export=download&confirm=$(wget --quiet --save-cookies ~/cookies.txt --keep-session-cookies --no-check-certificate 'https://docs.google.com/uc?export=download&id=173SEHgYuSoJ6eze-BaofzJutjd6bAIGo' -O- | sed -rn 's/.*confirm=([0-9A-Za-z_]+).*/\1\n/p')&id=173SEHgYuSoJ6eze-BaofzJutjd6bAIGo" -O /opt/ml/final-project-level2-cv-11/src/model/font_generator/gasnext/checkpoints/gasnext_weight.pth && rm -rf ~/cookies.txt
```

- Script Font ë‹¤ìš´ë¡œë“œ

```bash
# ë§í¬ : https://drive.google.com/file/d/1p7Rwc08Xbk9bHGIE_7UoWl5OQksfVHrm/view?usp=sharing
mkdir -p data/font/typical
wget --load-cookies ~/cookies.txt "https://docs.google.com/uc?export=download&confirm=$(wget --quiet --save-cookies ~/cookies.txt --keep-session-cookies --no-check-certificate 'https://docs.google.com/uc?export=download&id=1p7Rwc08Xbk9bHGIE_7UoWl5OQksfVHrm' -O- | sed -rn 's/.*confirm=([0-9A-Za-z_]+).*/\1\n/p')&id=1p7Rwc08Xbk9bHGIE_7UoWl5OQksfVHrm" -O /opt/ml/final-project-level2-cv-11/data/font/typical.zip && rm -rf ~/cookies.txt
unzip data/font/typical.zip -d data/font
```

- Effect Font ë‹¤ìš´ë¡œë“œ

```bash
# ë§í¬ : https://drive.google.com/file/d/14rTAp7WJpr4Cl4qLrh5H7qgeiy4SfHw9/view?usp=sharing
mkdir -p data/font/untypical
wget --load-cookies ~/cookies.txt "https://docs.google.com/uc?export=download&confirm=$(wget --quiet --save-cookies ~/cookies.txt --keep-session-cookies --no-check-certificate 'https://docs.google.com/uc?export=download&id=14rTAp7WJpr4Cl4qLrh5H7qgeiy4SfHw9' -O- | sed -rn 's/.*confirm=([0-9A-Za-z_]+).*/\1\n/p')&id=14rTAp7WJpr4Cl4qLrh5H7qgeiy4SfHw9" -O /opt/ml/final-project-level2-cv-11/data/font/untypical.zip && rm -rf ~/cookies.txt
unzip data/font/untypical.zip -d data/font
```

- .env íŒŒì¼ ì„¤ì •

```bash
# .envíŒŒì¼ ë§Œë“¤ê³  ì•„ë˜ ì…ë ¥
# ì‚¬ìš©ì„ ìœ„í•´ì„œ ë‘ ì‚¬ì´íŠ¸ì—ì„œ keyë¥¼ ë°œê¸‰ë°›ì•„ì•¼ í•©ë‹ˆë‹¤.
# íŒŒíŒŒê³ :https://developers.naver.com/docs/papago/papago-nmt-example-code.md
# Clova OCR: https://guide-fin.ncloud-docs.com/docs/ocr-ocr-1-4

PAPAGO_ID="ì¸ì¦ IDë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”"
PAPAGO_SECRET="ì¸ì¦ keyë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”"
CLOVA_URL="ì¸ì¦ URLì„ ì…ë ¥í•´ì£¼ì„¸ìš”"
CLOVA_KEY="ì¸ì¦ keyë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”"
```

- ì‹¤í–‰

```bash
# Backend (FastAPI) ì‹¤í–‰
cd src/
python -m backend
```

## Model
1. gasnext í•™ìŠµ ê°€ì¤‘ì¹˜ íŒŒì¼ ë‹¤ìš´ë¡œë“œ  
```bash
mkdir src/model/font_generator/gasnext/checkpoints
mkdir src/model/font_generator/gasnext/checkpoints/gas_test_100ep_aug
cd src/model/font_generator/gasnext/checkpoints/gas_test_100ep_aug
```
100epoch í•™ìŠµì‹œí‚¨ [gasnext ê°€ì¤‘ì¹˜ íŒŒì¼](https://drive.google.com/file/d/1tcOgqr2PxmHKfqDiu7gWCXKjBd8iad7S/view?usp=share_link)ì„ ë‹¤ìš´, gasnext/font_generate_gasnext.py 65 line ì°¸ì¡°  
2. gasnext ttf ìƒ˜í”Œ ë‹¤ìš´ë¡œë“œ  
[ìƒ˜í”Œ data](https://drive.google.com/file/d/1dCJFN8cGKi61qWil5TgA6efqJvnjt5mY/view?usp=sharing) ë‹¤ìš´ ë° ë ˆí¬ rootì—ì„œ ì••ì¶• í’€ê¸°




# ğŸ—ï¸Reference

- Font Generation
    - mxfont
        - paper: [https://arxiv.org/abs/2104.00887](https://arxiv.org/abs/2104.00887)
        - repo: [https://github.com/clovaai/mxfont](https://github.com/clovaai/mxfont)
    - gasnext:
        - paper: [https://arxiv.org/abs/2212.02886](https://arxiv.org/abs/2212.02886)
        - repo: [https://github.com/cmu-11785-F22-55/GAS-NeXt](https://github.com/cmu-11785-F22-55/GAS-NeXt)
- Dataset
    - font repo: [https://noonnu.cc/](https://noonnu.cc/)
    - typical font list: [https://twitter.com/Gold7ll/status/1351568186374721539](https://twitter.com/Gold7ll/status/1351568186374721539)
- Open source
    - svgs2ttf: [https://github.com/pteromys/svgs2ttf](https://github.com/pteromys/svgs2ttf)
    - pytesseract: [https://github.com/tesseract-ocr/tesstrain](https://github.com/tesseract-ocr/tesstrain)
    - tesseract: [https://github.com/tesseract-ocr/tesseract](https://github.com/tesseract-ocr/tesseract)
    - fontforge: [https://fontforge.org/en-US/](https://fontforge.org/en-US/)
 - API
    - PAPAGO: [https://developers.naver.com/products/papago/nmt/nmt.md](https://developers.naver.com/products/papago/nmt/nmt.md)
    - Clova OCR: [https://www.ncloud.com/product/aiService/ocr](https://www.ncloud.com/product/aiService/ocr)
